<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Blink Controlled Keyboard</title>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <style>
    body {
      background-color: #001f3f;
      color: white;
      font-family: Arial;
      text-align: center;
    }

    #display {
      width: 80%;
      height: 50px;
      font-size: 20px;
      margin-bottom: 20px;
      color: black;
      background-color: white;
      border-radius: 8px;
      border: none;
      padding: 10px;
    }

    #keyboard {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .key {
      width: 50px;
      height: 50px;
      background-color: #0074D9;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 8px;
      font-size: 18px;
    }

    .highlight {
      background-color: yellow;
      color: black;
      font-weight: bold;
      transform: scale(1.1);
      box-shadow: 0 0 10px yellow;
    }
  </style>
</head>
<body>
  <h1>Blink Controlled Keyboard</h1>
  <textarea id="display" readonly></textarea>
  <div id="keyboard"></div>

  <script>
    const socket = io();
    const display = document.getElementById("display");
    const keyboardDiv = document.getElementById("keyboard");

    const keyboard = [
      ['Q','W','E','R','T','Y','U','I','O','P'],
      ['A','S','D','F','G','H','J','K','L'],
      ['Z','X','C','V','B','N','M'],
      ['1','2','3','4','5','6','7','8','9','0'],
      ['SPACE', 'BACKSPACE']
    ];

    function buildKeyboard() {
      keyboard.forEach((row, i) => {
        const rowDiv = document.createElement("div");
        rowDiv.classList.add("row");
        row.forEach((key, j) => {
          const keyDiv = document.createElement("div");
          keyDiv.classList.add("key");
          keyDiv.id = `key-${i}-${j}`;
          keyDiv.textContent = key === "SPACE" ? "␣" : key === "BACKSPACE" ? "⌫" : key;
          rowDiv.appendChild(keyDiv);
        });
        keyboardDiv.appendChild(rowDiv);
      });
    }

    function highlightKey(row, col) {
      document.querySelectorAll(".key").forEach(k => k.classList.remove("highlight"));
      const key = document.getElementById(`key-${row}-${col}`);
      if (key) key.classList.add("highlight");
    }

    function addToDisplay(letter) {
      if (letter === "SPACE") {
        display.value += " ";
      } else if (letter === "BACKSPACE") {
        display.value = display.value.slice(0, -1);
      } else {
        display.value += letter;
      }
    }

    socket.on('highlight', data => {
      if (data.row != null && data.col != null) {
        highlightKey(data.row, data.col);
      }
    });

    socket.on('type_letter', data => {
      const { letter, row, col } = data;
      highlightKey(row, col);  // optional
      addToDisplay(letter);
    });

    window.onload = buildKeyboard;
  </script>
</body>
</html>